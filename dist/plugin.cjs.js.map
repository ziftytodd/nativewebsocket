{"version":3,"file":"plugin.cjs.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst NativeWebsocket = registerPlugin('NativeWebsocket', {\n    web: () => import('./web').then(m => new m.NativeWebsocketWeb()),\n});\nexport * from './definitions';\nexport { NativeWebsocket };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class NativeWebsocketWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.webSocket = null;\n    }\n    async connect(options) {\n        this.webSocket = new WebSocket(options.url);\n        this.webSocket.binaryType = 'arraybuffer';\n        this.webSocket.onopen = () => {\n            // Connected!\n            console.log('[NWS] Connected');\n            const ret = { connected: true };\n            this.notifyListeners('connected', ret);\n        };\n        this.webSocket.onmessage = async (msg) => {\n            // Got message\n            console.log('[NWS] Message received', msg);\n            let data = msg.data;\n            if (msg.data instanceof ArrayBuffer) {\n                data = base64ArrayBuffer(msg.data);\n            }\n            const ret = { data: data, binary: (msg.data instanceof ArrayBuffer) };\n            this.notifyListeners('message', ret);\n        };\n        this.webSocket.onerror = (err) => {\n            // Got error\n            console.log('[NWS] ERROR', err);\n            this.webSocket = null;\n            const ret = { reason: 'PWA Unknown', error: 'PWA Unknown' };\n            this.notifyListeners('disconnected', ret);\n        };\n        this.webSocket.onclose = (closed) => {\n            console.log('[NWS] Closed: ' + (closed ? closed.code : 'NoCode') + ' ' + (closed ? closed.reason : 'NoReason'));\n            this.webSocket = null;\n            const ret = { reason: 'PWA Close', error: 'PWA Close' };\n            this.notifyListeners('disconnected', ret);\n        };\n    }\n    async disconnect() {\n        if (this.webSocket) {\n            this.webSocket.close();\n            this.webSocket = null;\n        }\n        return { disconnected: true };\n    }\n    async send(options) {\n        console.log('[NWS] Send', options.message);\n        if (this.webSocket) {\n            this.webSocket.send(options.message);\n            return { sent: true };\n        }\n        return { sent: false };\n    }\n}\nfunction base64ArrayBuffer(arrayBuffer) {\n    let base64 = '';\n    const encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n    const bytes = new Uint8Array(arrayBuffer);\n    const byteLength = bytes.byteLength;\n    const byteRemainder = byteLength % 3;\n    const mainLength = byteLength - byteRemainder;\n    let a;\n    let b;\n    let c;\n    let d;\n    let chunk;\n    // Main loop deals with bytes in chunks of 3\n    for (let i = 0; i < mainLength; i += 3) {\n        // Combine the three bytes into a single integer\n        chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2];\n        // Use bitmasks to extract 6-bit segments from the triplet\n        a = (chunk & 16515072) >> 18; // 16515072 = (2^6 - 1) << 18\n        b = (chunk & 258048) >> 12; // 258048   = (2^6 - 1) << 12\n        c = (chunk & 4032) >> 6; // 4032     = (2^6 - 1) << 6\n        d = chunk & 63; // 63       = 2^6 - 1\n        // Convert the raw binary segments to the appropriate ASCII encoding\n        base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];\n    }\n    // Deal with the remaining bytes and padding\n    if (byteRemainder === 1) {\n        chunk = bytes[mainLength];\n        a = (chunk & 252) >> 2; // 252 = (2^6 - 1) << 2\n        // Set the 4 least significant bits to zero\n        b = (chunk & 3) << 4; // 3   = 2^2 - 1\n        base64 += `${encodings[a]}${encodings[b]}==`;\n    }\n    else if (byteRemainder === 2) {\n        chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1];\n        a = (chunk & 64512) >> 10; // 64512 = (2^6 - 1) << 10\n        b = (chunk & 1008) >> 4; // 1008  = (2^6 - 1) << 4\n        // Set the 2 least significant bits to zero\n        c = (chunk & 15) << 2; // 15    = 2^4 - 1\n        base64 += `${encodings[a]}${encodings[b]}${encodings[c]}=`;\n    }\n    return base64;\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}