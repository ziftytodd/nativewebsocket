{"version":3,"file":"plugin.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst NativeWebsocket = registerPlugin('NativeWebsocket', {\n    web: () => import('./web').then(m => new m.NativeWebsocketWeb()),\n});\nexport * from './definitions';\nexport { NativeWebsocket };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class NativeWebsocketWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.webSocket = null;\n    }\n    async connect(options) {\n        this.webSocket = new WebSocket(options.url);\n        this.webSocket.binaryType = 'arraybuffer';\n        this.webSocket.onopen = () => {\n            // Connected!\n            console.log('[NWS] Connected');\n            const ret = { connected: true };\n            this.notifyListeners('connected', ret);\n        };\n        this.webSocket.onmessage = async (msg) => {\n            // Got message\n            console.log('[NWS] Message received', msg);\n            let data = msg.data;\n            if (msg.data instanceof ArrayBuffer) {\n                data = base64ArrayBuffer(msg.data);\n            }\n            const ret = { data: data, binary: (msg.data instanceof ArrayBuffer) };\n            this.notifyListeners('message', ret);\n        };\n        this.webSocket.onerror = (err) => {\n            // Got error\n            console.log('[NWS] ERROR', err);\n            this.webSocket = null;\n            const ret = { reason: 'PWA Unknown', error: 'PWA Unknown' };\n            this.notifyListeners('disconnected', ret);\n        };\n        this.webSocket.onclose = (closed) => {\n            console.log('[NWS] Closed: ' + (closed ? closed.code : 'NoCode') + ' ' + (closed ? closed.reason : 'NoReason'));\n            this.webSocket = null;\n            const ret = { reason: 'PWA Close', error: 'PWA Close' };\n            this.notifyListeners('disconnected', ret);\n        };\n    }\n    async disconnect() {\n        if (this.webSocket) {\n            this.webSocket.close();\n            this.webSocket = null;\n        }\n        return { disconnected: true };\n    }\n    async send(options) {\n        console.log('[NWS] Send', options.message);\n        if (this.webSocket) {\n            this.webSocket.send(options.message);\n            return { sent: true };\n        }\n        return { sent: false };\n    }\n}\nfunction base64ArrayBuffer(arrayBuffer) {\n    let base64 = '';\n    const encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n    const bytes = new Uint8Array(arrayBuffer);\n    const byteLength = bytes.byteLength;\n    const byteRemainder = byteLength % 3;\n    const mainLength = byteLength - byteRemainder;\n    let a;\n    let b;\n    let c;\n    let d;\n    let chunk;\n    // Main loop deals with bytes in chunks of 3\n    for (let i = 0; i < mainLength; i += 3) {\n        // Combine the three bytes into a single integer\n        chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2];\n        // Use bitmasks to extract 6-bit segments from the triplet\n        a = (chunk & 16515072) >> 18; // 16515072 = (2^6 - 1) << 18\n        b = (chunk & 258048) >> 12; // 258048   = (2^6 - 1) << 12\n        c = (chunk & 4032) >> 6; // 4032     = (2^6 - 1) << 6\n        d = chunk & 63; // 63       = 2^6 - 1\n        // Convert the raw binary segments to the appropriate ASCII encoding\n        base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];\n    }\n    // Deal with the remaining bytes and padding\n    if (byteRemainder === 1) {\n        chunk = bytes[mainLength];\n        a = (chunk & 252) >> 2; // 252 = (2^6 - 1) << 2\n        // Set the 4 least significant bits to zero\n        b = (chunk & 3) << 4; // 3   = 2^2 - 1\n        base64 += `${encodings[a]}${encodings[b]}==`;\n    }\n    else if (byteRemainder === 2) {\n        chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1];\n        a = (chunk & 64512) >> 10; // 64512 = (2^6 - 1) << 10\n        b = (chunk & 1008) >> 4; // 1008  = (2^6 - 1) << 4\n        // Set the 2 least significant bits to zero\n        c = (chunk & 15) << 2; // 15    = 2^4 - 1\n        base64 += `${encodings[a]}${encodings[b]}${encodings[c]}=`;\n    }\n    return base64;\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}